{{#if entitiesThatExistInMISP.length}}
  <h1 class="p-title">
    {{fa-icon "info-circle" size="sm"}} Found IOCs
  </h1>
  {{#if isDeleting}}
    <div class="ioc-deletion-modal">
      <div class="note">
        <span class="p-key">
          <span class="p-value"><em><b>DANGER:</b></em></span>
          <div>
            <span>Deleting an attribute cannot be undone and will remove all data for the attribute in MISP.  Deleting the attribute will not delete associated events.</span>
          </div>
          <div>
            <span>Are you sure you want to delete the attribute <em><b>{{entityToDelete.value}}</b></em>?</span>
          </div>
        </span>
        <div class="delete-confirmation-button">
          <button class="cancel-delete" {{action "cancelItemDeletion"}}>Cancel</button>
          <button class="p-btn btn btn-danger m-0" {{action "confirmDelete"}}>Delete</button>
        </div>
      </div>
    </div>
  {{/if}}
  <table class="w-100">
    <tbody>
      {{#each entitiesThatExistInMISP as |intel|}}
        <tr>
          <td>
            {{#if (not interactionDisabled)}}
              <a href="{{details.url}}/events/view/{{intel.event_id}}">{{intel.value}} {{fa-icon "external-link" fixedWidth=true class="external-link-icon"}}</a>
            {{else}}
              <a>{{intel.value}} {{fa-icon "external-link" fixedWidth=true class="external-link-icon"}}</a>
            {{/if}}
          </td>
          <td class="type">
            <span>{{intel.type}}</span>
          </td>
          {{#if block.userOptions.allowDelete}}
            <td class="icon">
              <button
                class="no-style-button delete"
                {{action "initiateItemDeletion" intel}}
                title="Delete IOC from MISP"
                disabled={{interactionDisabled}}
              >
                {{fa-icon "trash" fixedWidth=true}}
              </button>
            </td>
          {{/if}}
        </tr>
      {{/each}}
    </tbody>
  </table>

  <div class="d-flex flex-row justify-content-between align-items-center">
    <div>
      {{#if deleteIsRunning}}
        {{fa-icon "spinner-third" fixedWidth=true spin=true}} Deleting...
      {{/if}}
    </div>

    {{#if deleteMessage}}
      <div class="alert alert-info mt-1">
        {{deleteMessage}}
      </div>
    {{/if}}
    {{#if deleteErrorMessage}}
      <div class="alert alert-danger mt-1">
        {{deleteErrorMessage}}
      </div>
    {{/if}}
  </div>
{{/if}}

{{#if (or newIocs.length newIocsToSubmit.length)}}
    <h1 class="p-title">
      {{fa-icon "sparkles" size="sm" fixedWidth=true}} New IOCs
    </h1>
    <table class="w-100">
      <tbody>
        {{#each newIocs as |entity|}}
          <tr>
            <td>
              <span>{{entity.value}}</span>
            </td>
            <td class="type">
              <span>{{entity.type}}</span>
            </td>
            <td class="icon">
              <button
                class="no-style-button add"
                {{action "addSubmitItem" entity}}
                title="Add IOC to submission list"
                disabled={{interactionDisabled}}
              >
                {{fa-icon "plus" fixedWidth=true}}
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>

  {{#if (not newIocs.length)}}
    <div class="note">
      <span class="p-key"><em>NONE</em></span>
    </div>
  {{/if}}
  <h1 class="p-title">
    {{fa-icon "upload" size="sm" fixedWidth=true}} New IOCs to Submit
  </h1>
  <table class="w-100">
    <tbody>
      {{#each newIocsToSubmit as |entity|}}
        <tr>
          <td class="intellValue">
            <span>{{entity.value}}</span>
          </td>
          <td class="type">
            <span>{{entity.type}}</span>
          </td>
          <td class="icon">
            <button
              class="no-style-button remove"
              title="Remove IOC from submission list"
              {{action "removeSubmitItem" entity}}
              disabled={{interactionDisabled}}
            >
              {{fa-icon "minus" fixedWidth=true}}
            </button>
          </td>
        </tr>
      {{/each}}
    </tbody>
  </table>
    {{#if (not newIocsToSubmit.length)}}
      <div class="note">
        <span class="p-key"><em>NONE</em></span>
      </div>
    {{/if}}
      <h1 class="p-title py-1">
        {{fa-icon "cog" size="sm" fixedWidth=true}} Submission Options
      </h1>
      <div>
        <label>
          {{input
            type="checkbox"
            checked=shouldPublish
            disabled=interactionDisabled
          }}
          <span class="align-top">Should Publish</span>
        </label>
      </div>
      <div class="selectContainer pt-1">
        <span class="p-value">Distribution: </span>
        <select class="w-100" onchange={{action (mut distribution) value="target.value"}} disabled={{interactionDisabled}}>
            <option value="0">Your organisation only</option>
            <option value="1">This community only</option>
            <option value="2">Connected communities</option>
            <option value="3">All communities</option>
        </select>
      </div>
      <div class="selectContainer">
        <span class="p-value">Threat Level: </span>
        <select class="w-100" onchange={{action (mut threatLevel) value="target.value"}} disabled={{interactionDisabled}}>
            <option value="1">High</option>
            <option value="2">Medium</option>
            <option value="3">Low</option>
            <option value="4">Undefined</option>
        </select>
      </div>
      <div class="selectContainer">
        <span class="p-value">Analysis: </span>
        <select class="w-100" onchange={{action (mut analysis) value="target.value"}} disabled={{interactionDisabled}}>
            <option value="0">Initial</option>
            <option value="1">Ongoing</option>
            <option value="2">Completed</option>
        </select>
      </div>
      <div class="selectContainer">
        <span class="p-value">Event Name: </span>
        <input
          type="text"
          class="w-100"
          onchange={{action (mut eventInfo) value="target.value"}}
          value={{eventInfo}}
          disabled={{interactionDisabled}}
        />
      </div>

      <div class="tag-container">
        <h1 class="p-title">
          {{fa-icon "tags" fixedWidth=true}} Tags
        </h1>
        {{#each (take maxTagsInBlock selectedTags) as |tag tagIndex|}}
          {{#if tag.isNew}}
            <span class="tag" style="border-color: {{tag.colour}}" >
              {{tag.name}}
              <button class="tag-btn delete-tag-btn" {{action "deleteTag" tag}} disabled={{interactionDisabled}}>
                {{fa-icon "times" fixedWidth=true}}
              </button>
            </span>
          {{else}}
            <a href="{{details.url}}/events/index/searchtag:{{tag.id}}" class="tag" style="border-color: {{tag.colour}}" >
              {{tag.name}}
              <button class="tag-btn delete-tag-btn" {{action "deleteTag" tag}} disabled={{interactionDisabled}}>
                {{fa-icon "times" fixedWidth=true}}
              </button>
            </a>
          {{/if}}
        {{/each}}

        <div class="edit-tags-btn-container">
          <span class="p-action" {{action "editTags"}}>Add Tags {{fa-icon (if editingTags "caret-up" "caret-down") fixedWidth=true}}</span>
        </div>

        {{#if editingTags}}
          <div class="edit-tags-container">
            <div class="input-group add-tag-container">
              {{#power-select
                triggerClass="form-control"
                selected=selectedTag
                options=existingTags
                searchEnabled=true
                search=(action "searchTags")
                placeholder="Add Tag"
                searchField="name"
                searchMessage="Loading Tags ..."
                loadingMessage="Loading Tags ..."
                searchPlaceholder="Search tags"
                closeOnSelect=true
                disabled=interactionDisabled
                onOpen=(action "searchTags" "")
                onChange=(action (mut selectedTag)) as |tag|
              }}
                {{tag.name}}
                {{#if tag.isNew}}
                    {{fa-icon "plus-circle" fixedWidth=true}}
                {{else}}
                    {{fa-icon "check-circle" fixedWidth=true}}
                {{/if}}
              {{/power-select}}

              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" {{action "addTag"}} disabled={{interactionDisabled}}>
                  {{fa-icon "plus" fixedWidth=true}}
                </button>
              </div>
            </div>
          </div>
        {{/if}}
      </div>

    <div class="d-flex flex-row-reverse justify-content-between align-items-center mt-2">
      <button {{action "submitItems"}}
              disabled={{interactionDisabled}}
              class="p-btn btn btn-secondary m-0">
        {{#if createIsRunning}}
          {{fa-icon "spinner-third" fixedWidth=true spin=true}}
        {{else}}
          Submit IOCs
        {{/if}}
      </button>

      {{#if createMessage}}
        <div class="create-message alert alert-info m-0">
          {{createMessage}}
        </div>
      {{/if}}

      {{#if createErrorMessage}}
        <div class="create-message alert alert-danger m-0">
          {{createErrorMessage}}
        </div>
      {{/if}}
    </div>
{{/if}}
<div class={{if (and (not (or newIocs.length newIocsToSubmit.length)) interactionDisabled) "modal-open"}}></div>
{{#if (and (not entitiesThatExistInMISP.length) (not (or newIocs.length newIocsToSubmit.length)))}}
  <div class="note">
    <span class="p-key"><em>All Found IOCs have been deleted</em></span>
  </div>
{{/if}}